<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MorphoRegions • MorphoRegions</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MorphoRegions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MorphoRegions</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/MorphoRegions.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aagillet/MorphoRegions/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MorphoRegions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/aagillet/MorphoRegions/blob/master/vignettes/MorphoRegions.Rmd" class="external-link"><code>vignettes/MorphoRegions.Rmd</code></a></small>
      <div class="d-none name"><code>MorphoRegions.Rmd</code></div>
    </div>

    
    
<style>
p.caption {
  font-size: 0.82em;
  text-align: center;
  margin-right: 8% ;
  margin-left: 8% ;
}
img {
  border: 0;
}
</style>
<div class="section level2">
<h2 id="about-morphoregions">About <em>MorphoRegions</em><a class="anchor" aria-label="anchor" href="#about-morphoregions"></a>
</h2>
<p>The <em>MorphoRegions</em> package is built to
<strong>computationally identify regions</strong> (morphological,
functional, etc.) <strong>in serially homologous structures</strong>
such as, but not limited to, the vertebrate backbone. Regions are
modeled as segmented linear regressions with each segment corresponding
to a region and region boundaries (or breakpoints) corresponding to
changes along the serially homologous structure. The optimal number of
regions and their breakpoint positions are identified without <em>a
priori</em> assumptions. The algorithm fits increasingly complex models
(increasing number of regions). For each given number of regions, all
possible combinations of breakpoint positions will be iteratively
fitted. Maximum-likelihood methods are then used to identify the best
model, as described in <span class="citation">Gillet, Jones, and Pierce
(<a href="#ref-GilRev">Under Review</a>)</span>.</p>
<div class="figure" style="text-align: center">
<img src="images/Regions_image2.jpg" alt="**Fig.1.** *MorphoRegions* identifies regions in serially-homologous structures by fitting all possible breakpoint positions for a given number of region and then repeating the method on increasingly complex models." width="30%"><img src="images/Gif_segreg_1bp_25delay.gif" alt="**Fig.1.** *MorphoRegions* identifies regions in serially-homologous structures by fitting all possible breakpoint positions for a given number of region and then repeating the method on increasingly complex models." width="30%"><img src="images/Gif_segreg_50delay.gif" alt="**Fig.1.** *MorphoRegions* identifies regions in serially-homologous structures by fitting all possible breakpoint positions for a given number of region and then repeating the method on increasingly complex models." width="30%"><p class="caption">
<strong>Fig.1.</strong> <em>MorphoRegions</em> identifies regions in
serially-homologous structures by fitting all possible breakpoint
positions for a given number of region and then repeating the method on
increasingly complex models.
</p>
</div>
<p><br> This package is an updated version of the <a href="https://github.com/katrinajones/regions" class="external-link"><em>regions</em>
R-package</a> from <span class="citation">Jones et al. (<a href="#ref-Jones2018">2018</a>)</span> which expanded on previous work
from <span class="citation">Head and Polly (<a href="#ref-Head2015">2015</a>)</span>. This package provides improved
computational methods (reduced time and memory usage) allowing
application to larger datasets. Several features have been added
including the options to perform non-exhaustive searches, run parallel
computing, choose between continuous and discontinuous fitting methods,
define the minimum number of vertebrae in each region, select the best
model using either AICc or BIC, and fit a model to multiple specimens.
Plotting options have also been expanded.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="package-installation">Package installation<a class="anchor" aria-label="anchor" href="#package-installation"></a>
</h2>
<p>The package is available on CRAN and can be installed and loaded
using the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"MorphoRegions"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aagillet.github.io/MorphoRegions/">MorphoRegions</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="preparing-the-data">Preparing the data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h2>
<p>Data should be provided as a dataframe where each row is an element
of the serially-homologous structure (e.g., a vertebra). One column
should contain positional information of each element (e.g., vertebral
number) and other columns should contain variables that will be used to
calculate regions (e.g., morphological measurements).</p>
<p>The package comes with <strong>four built-in datasets</strong>.
<code>alligator</code>, <code>musm</code>, and <code>dolphin</code>
contain measurements on the vertebrae of an alligator, mouse, and
dolphin. <code>porpoise</code> contains vertebral measurements of three
specimens of harbor porpoises and can be used to test fitting a single
model for multiple specimens together (<a href="#IntraSp">see
below</a>). <em>Alligator and mouse data are from <span class="citation">Jones et al. (<a href="#ref-Jones2018">2018</a>)</span>; dolphin and porpoise data are
from <span class="citation">Gillet et al. (<a href="#ref-Gillet2022">2022</a>)</span>.</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dolphin"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dolphin</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Vertebra   Lc   Wc   Hc  Hnp  Wnp  Inp   Ha   Wa   Lm   Wm  Hm Hch Wch  Ltp</span></span>
<span><span class="co">#&gt; 8         8 1.33 3.37 2.02 2.85 1.17 2.01 1.72 1.48 0.00 0.00 0.0   0   0 1.71</span></span>
<span><span class="co">#&gt; 9         9 1.46 3.67 2.10 3.20 1.63 2.01 1.44 1.65 0.00 0.00 0.0   0   0 1.51</span></span>
<span><span class="co">#&gt; 10       10 1.57 3.62 2.26 3.13 1.71 2.01 1.42 2.18 0.00 0.00 0.0   0   0 1.06</span></span>
<span><span class="co">#&gt; 11       11 1.71 3.75 2.24 3.07 1.71 2.01 1.38 1.25 0.56 0.38 1.7   0   0 1.03</span></span>
<span><span class="co">#&gt; 12       12 1.74 3.72 2.28 2.66 1.96 1.99 1.30 1.50 1.45 1.09 2.0   0   0 0.60</span></span>
<span><span class="co">#&gt; 13       13 1.82 3.92 2.28 2.61 1.74 1.88 1.29 1.74 1.86 1.12 2.0   0   0 0.37</span></span>
<span><span class="co">#&gt;     Wtp  Itp</span></span>
<span><span class="co">#&gt; 8  1.67 1.57</span></span>
<span><span class="co">#&gt; 9  1.61 1.57</span></span>
<span><span class="co">#&gt; 10 1.90 1.57</span></span>
<span><span class="co">#&gt; 11 1.91 1.66</span></span>
<span><span class="co">#&gt; 12 1.71 1.57</span></span>
<span><span class="co">#&gt; 13 1.44 1.57</span></span></code></pre></div>
<p>In the <code>dolphin</code> dataset, the first column contains
positional information (vertebral number) while other columns contain
morphological measurements taken on each vertebra.</p>
<p><strong>Prior to analysis, data must be processed into an object
usable by <code>regions</code> using
<code><a href="../reference/process_measurements.html">process_measurements()</a></code>. Data should be provided as a
dataframe</strong>. The <code>pos</code> argument is used to specify the
name or index of the column containing positional information; if
unspecified, the first column will be used by default. Names or indices
of columns containing variables can be specified with the
<code>measurements</code> argument. The <code>fillNA</code> argument
allows to fill missing values in the dataset. Missing values can be
filled for up to two successive elements (e.g., up to two successive
vertebrae) using a linear imputation (see <span class="citation">Jones
et al. (<a href="#ref-Jones2018">2018</a>)</span> for more details). The
<code>fillNA</code> argument is set to <code>TRUE</code> by default.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dolphin_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_measurements.html">process_measurements</a></span><span class="op">(</span><span class="va">dolphin</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dolphin_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "regions_data"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="PCO">Data ordination<a class="anchor" aria-label="anchor" href="#PCO"></a>
</h2>
<p>To allow the analysis of high dimensional datasets, including a
variety of data types, a <strong>Principal Coordinates Analysis
(PCO)</strong>, a distance-based data ordination method, is implemented
in <code><a href="../reference/svdPCO.html">svdPCO()</a></code>. The function relies on a distance matrix
generated by <code><a href="https://rdrr.io/pkg/cluster/man/daisy.html" class="external-link">cluster::daisy()</a></code>, which tolerates missing
values. Three types of distance metric can be used: Euclidean,
Manhattan, or Gower. Euclidean should only be used where all variables
are similar (e.g., linear measures on the same scale), and is most
similar to a PCA. Gower is good for combining different types of
continuous data (e.g., angles and linear).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dolphin_pco</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svdPCO.html">svdPCO</a></span><span class="op">(</span><span class="va">dolphin_data</span>, metric <span class="op">=</span> <span class="st">"gower"</span><span class="op">)</span></span></code></pre></div>
<p>PCO scores of each vertebra can be plotted along their respective
position in backbone (left) or as a morphospace (right).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Plot PCOs along backbone for PC1 and 2:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot morphospace of PC1 and 2:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, pco_x <span class="op">=</span> <span class="fl">1</span>, pco_y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-7-1.png" alt="**Fig.2.** *Left*: PCO scores of each vertebra along the backbone for PCO1 *(top)* and PCO2 *(bottom)*. *Right*: morphospace defined by PCO1 and 2, points plotted as numbers corresponding to the position of each vertebra along the backbone." width="48%"><img src="MorphoRegions_files/figure-html/unnamed-chunk-7-2.png" alt="**Fig.2.** *Left*: PCO scores of each vertebra along the backbone for PCO1 *(top)* and PCO2 *(bottom)*. *Right*: morphospace defined by PCO1 and 2, points plotted as numbers corresponding to the position of each vertebra along the backbone." width="48%"><p class="caption">
<strong>Fig.2.</strong> <em>Left</em>: PCO scores of each vertebra along
the backbone for PCO1 <em>(top)</em> and PCO2 <em>(bottom)</em>.
<em>Right</em>: morphospace defined by PCO1 and 2, points plotted as
numbers corresponding to the position of each vertebra along the
backbone.
</p>
</div>
<div class="section level3">
<h3 id="data-reduction">Data reduction<a class="anchor" aria-label="anchor" href="#data-reduction"></a>
</h3>
<p>While the regionalization analysis can be performed on all PCO axes,
it’s likely that lower PCO axes mostly contain noise. The number of PCO
axes to retain for analysis can be selected using
<code><a href="../reference/PCOselect.html">PCOselect()</a></code>.</p>
<p><strong>Four different methods to select PCOs</strong> are available
and be specified using the <code>method</code> argument:</p>
<ul>
<li>
<code>"manual"</code>: the number of PCOs is directly defined via
the <code>scores</code> argument</li>
<li>
<code>"variance"</code>: PCO axes with a variance (defined as the
ratio between the eigenvalue of the given axis and the sum of all
eigenvalues) higher to the <code>cutoff</code> value (expressed as a
value between 0 and 1) are retained</li>
<li>
<code>"max"</code>: PCOs axes needed to obtain the maximum number of
regions in the segmented models tested which must be supplied to
<code>results</code>. The criterion (AICc or BIC) used to maximize the
region score should be defined with <code>criterion</code>
</li>
<li>
<code>"boot"</code>: PCO axes are selected through bootstrapping by
comparing observed eigenvalues to eigenvalues from randomized data and
retaining PCO axes with eigenvalues higher than values from randomized
data. When using this method, the screeplot showing observed and
simulated eigenvalues can be plotted. <em>Note that bootstrapping is
sensitive to unequal variances of variables and should only be used on
data that have been scaled (setting <code>scale = TRUE</code> in the
original call to <code><a href="../reference/svdPCO.html">svdPCO()</a></code>).</em>
</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manual (keeping axes 1 to 3):</span></span>
<span><span class="va">PCOs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCOselect.html">PCOselect</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, method <span class="op">=</span> <span class="st">"manual"</span>,</span>
<span>                  scores <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">PCOs</span></span>
<span><span class="co">#&gt; A `regions_pco_select` object</span></span>
<span><span class="co">#&gt; - PCO scores selected: 1, 2, 3</span></span>
<span><span class="co">#&gt; - Method: manual</span></span>
<span></span>
<span><span class="co"># Variance (selecting axes with variance &gt; 0.05):</span></span>
<span><span class="va">PCOs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCOselect.html">PCOselect</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, method <span class="op">=</span> <span class="st">"variance"</span>,</span>
<span>                  cutoff <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span></span>
<span><span class="va">PCOs</span></span>
<span><span class="co">#&gt; A `regions_pco_select` object</span></span>
<span><span class="co">#&gt; - PCO scores selected: 1, 2</span></span>
<span><span class="co">#&gt; - Method: variance (cutoff: 0.05)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Max:</span></span>
<span><span class="va">regionresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">39</span>, noregions <span class="op">=</span> <span class="fl">4</span>, </span>
<span>                             minvert <span class="op">=</span> <span class="fl">3</span>, cont <span class="op">=</span> <span class="cn">TRUE</span>, exhaus <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">PCOs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCOselect.html">PCOselect</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, method <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>                  results <span class="op">=</span> <span class="va">regionresults</span>,</span>
<span>                  criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span><span class="va">PCOs</span></span>
<span><span class="co">#&gt; A `regions_pco_select` object</span></span>
<span><span class="co">#&gt; - PCO scores selected: 1</span></span>
<span><span class="co">#&gt; - Method: max (criterion: BIC)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">PCOs</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-9-1.png" alt="**Fig.3a.** Graph of region scores (left y-axis) and cumulative variance (right y-axis) obtained with varying number of PCO axes included for AICc (left graph) and BIC (right graph). Blue triangles correspond to region score obtained for each individual PCO axis and orange circle to region scores obtained with cumulative number of PCO axes. The cumulated variance explained by PCO axes is represented by the grey curve." width="60%"><p class="caption">
<strong>Fig.3a.</strong> Graph of region scores (left y-axis) and
cumulative variance (right y-axis) obtained with varying number of PCO
axes included for AICc (left graph) and BIC (right graph). Blue
triangles correspond to region score obtained for each individual PCO
axis and orange circle to region scores obtained with cumulative number
of PCO axes. The cumulated variance explained by PCO axes is represented
by the grey curve.
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bootstrap:</span></span>
<span><span class="va">PCOs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCOselect.html">PCOselect</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, method <span class="op">=</span> <span class="st">"boot"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bootstrapping...</span></span>
<span><span class="va">PCOs</span></span>
<span><span class="co">#&gt; A `regions_pco_select` object</span></span>
<span><span class="co">#&gt; - PCO scores selected: 1, 2</span></span>
<span><span class="co">#&gt; - Method: boot (500 replications)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">PCOs</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-10-1.png" alt="**Fig.3b.** Screeplot of observed eigenvalues (line) and eigenvalues from randomized data (boxes). Here PCO axes 1 and 2 are retained for subsequent analyses." width="60%"><p class="caption">
<strong>Fig.3b.</strong> Screeplot of observed eigenvalues (line) and
eigenvalues from randomized data (boxes). Here PCO axes 1 and 2 are
retained for subsequent analyses.
</p>
</div>
</div>
<div class="section level3">
<h3 id="loadings">Loadings<a class="anchor" aria-label="anchor" href="#loadings"></a>
</h3>
<p>Correlations between original variables and each PCO axis are
obtained through the <code>PCOload</code> function. The additional
‘Size’ variable corresponds to the mean value of the variables.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCOload.html">PCOload</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">loadings</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-11-1.png" alt="**Fig.4.** Correlations between original variables and PCO axes 1 and 2." width="70%"><p class="caption">
<strong>Fig.4.</strong> Correlations between original variables and PCO
axes 1 and 2.
</p>
</div>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="regionalization-analysis">Regionalization analysis<a class="anchor" aria-label="anchor" href="#regionalization-analysis"></a>
</h2>
<p>The regionalization analysis is performed in three steps:</p>
<ol style="list-style-type: decimal">
<li><p>Fitting all possible models for all number of regions
requested</p></li>
<li><p>Selecting the best model for each number of regions
tested</p></li>
<li><p>Selecting the overall best model</p></li>
</ol>
<div class="section level3">
<h3 id="SegRegFit">Fitting segmented linear regressions<a class="anchor" aria-label="anchor" href="#SegRegFit"></a>
</h3>
<p><code><a href="../reference/calcregions.html">calcregions()</a></code> fits all possible combinations of
breakpoints (boundaries between successive regions) for each number of
regions to be tested. The analysis will fit models on PCO scores, so the
output of <code><a href="../reference/svdPCO.html">svdPCO()</a></code> needs to be provided. The number of PCOs
to keep (supplied either as a vector or as the output of
<code><a href="../reference/PCOselect.html">PCOselect()</a></code>), and the maximum number of regions to test
need to be provided with the <code>scores</code> and
<code>noregions</code> arguments, respectively.</p>
<p>The function also offers <strong>several optional arguments</strong>
(see the <a href="#FittingOptions">Model fitting options</a> section for
details):</p>
<ul>
<li>
<code>minvert</code>: define the minimum number of vertebrae
(elements) in each region (<a href="#MinVert">see here</a>)</li>
<li>
<code>cont</code>: choose to fit either a continuous fit
(<code>TRUE</code>) or discontinuous fit (<code>FALSE</code>) (<a href="#ContDisc">see here</a>)</li>
<li>
<code>includebp</code>: force breakpoint(s) to fall at the supplied
value(s) (<a href="#ForceBP">see here</a>)</li>
<li>
<code>omitbp</code>: exclude breakpoint(s) falling at the supplied
value(s) (<a href="#ForceBP">see here</a>)</li>
<li>
<code>exhaus</code>: either to fit all possible combinations
(<code>TRUE</code>) or only the most probable ones (<code>FALSE</code>)
to reduce computing time (<a href="#Exhaus">see here</a>)</li>
<li>
<code>cl</code>: option to use parallel computation (<a href="#Para">see here</a>)</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regionresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>, noregions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                             minvert <span class="op">=</span> <span class="fl">3</span>, cont <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                             exhaus <span class="op">=</span> <span class="cn">TRUE</span>, cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The output of the function contains information on the parameters
used to run the analysis and total number of models tested while using
the <code>summary</code> function allows to see how many models are
possible and how many have been tested for each given number of
regions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regionresults</span></span>
<span><span class="co">#&gt; A `regions_results` object</span></span>
<span><span class="co">#&gt;  - number of PCOs used: 2 </span></span>
<span><span class="co">#&gt;  - number of regions: 1, 2, 3, 4, 5 </span></span>
<span><span class="co">#&gt;  - model type: continuous </span></span>
<span><span class="co">#&gt;  - min vertebrae per region: 3 </span></span>
<span><span class="co">#&gt;  - total models saved: 28810 </span></span>
<span><span class="co">#&gt; Use `summary()` to examine summaries of the fitting process.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">regionresults</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Regions Possible Tested Saved Comp. method Saving method</span></span>
<span><span class="co">#&gt;        1        1      1     1   Exhaustive           All</span></span>
<span><span class="co">#&gt;        2       35     35    35   Exhaustive           All</span></span>
<span><span class="co">#&gt;        3      528    528   528   Exhaustive           All</span></span>
<span><span class="co">#&gt;        4     4495   4495  4495   Exhaustive           All</span></span>
<span><span class="co">#&gt;        5    23751  23751 23751   Exhaustive           All</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="selecting-best-model-for-each-number-of-regions">Selecting best model for each number of regions<a class="anchor" aria-label="anchor" href="#selecting-best-model-for-each-number-of-regions"></a>
</h3>
<p><code><a href="../reference/modelselect.html">modelselect()</a></code> retains the best model for each number of
regions tested. The best models are selected as the ones with the lowest
residual sum of squares (RSS).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">regionresults</span><span class="op">)</span></span>
<span><span class="va">models</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 sumRSS RSS.1 RSS.2</span></span>
<span><span class="co">#&gt;        1    .    .    .    .  1.898 1.456 0.441</span></span>
<span><span class="co">#&gt;        2   26    .    .    .  0.413 0.105 0.308</span></span>
<span><span class="co">#&gt;        3   23   29    .    .  0.147 0.092 0.055</span></span>
<span><span class="co">#&gt;        4   23   30   40    .  0.073 0.034 0.040</span></span>
<span><span class="co">#&gt;        5   23   27   34   40  0.046 0.026 0.020</span></span></code></pre></div>
<p>Each row of the output corresponds to the best model for a given
number of regions. Columns named <code>BP</code> give the position of
region boundaries (or breakpoints), each value corresponding to the
position of the last element (vertebra) of a given region. The other
columns provide the total residual sum of squares across all PC axes
(<code>sumRSS</code>) and the residual sum of square for each PC axis
individually (<code>RSS.</code>).</p>
<p>In the example above, in the model with three regions, the first
region encompasses vertebrae 8 (first vertebra in the dataset) to 23,
the second contains vertebrae 24 to 29, and the last region contains
vertebrae 30 to 47 (last vertebra in the dataset).</p>
</div>
<div class="section level3">
<h3 id="selecting-best-overall-model-and-region-score">Selecting best overall model and region score<a class="anchor" aria-label="anchor" href="#selecting-best-overall-model-and-region-score"></a>
</h3>
<p><code><a href="../reference/modelsupport.html">modelsupport()</a></code> will find the best overall models across
the models returned by <code><a href="../reference/modelselect.html">modelselect()</a></code>. The best model is
<strong>calculated using AICc or BIC</strong> which allows the selection
of the best fit model while penalizing for models that are too complex.
<em>See <span class="citation">Jones et al. (<a href="#ref-Jones2018">2018</a>)</span> for AICc calculations and <span class="citation">Gillet, Jones, and Pierce (<a href="#ref-GilRev">Under
Review</a>)</span> for BIC calculations.</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">supp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span>
<span><span class="va">supp</span></span>
<span><span class="co">#&gt; - Model support (AICc)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 sumRSS     AICc deltaAIC model_lik Ak_weight</span></span>
<span><span class="co">#&gt;        5   23   27   34   40  0.046 -556.036    0.000         1         1</span></span>
<span><span class="co">#&gt;        4   23   30   40    .  0.073 -528.096   27.940         0         0</span></span>
<span><span class="co">#&gt;        3   23   29    .    .  0.147 -480.952   75.084         0         0</span></span>
<span><span class="co">#&gt;        2   26    .    .    .  0.413 -405.787  150.250         0         0</span></span>
<span><span class="co">#&gt;        1    .    .    .    .  1.898 -290.769  265.267         0         0</span></span>
<span><span class="co">#&gt; Region score: 5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Model support (BIC)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 sumRSS      BIC deltaBIC model_lik BIC_weight</span></span>
<span><span class="co">#&gt;        5   23   27   34   40  0.046 -526.559    0.000         1          1</span></span>
<span><span class="co">#&gt;        4   23   30   40    .  0.073 -502.645   23.914         0          0</span></span>
<span><span class="co">#&gt;        3   23   29    .    .  0.147 -460.321   66.238         0          0</span></span>
<span><span class="co">#&gt;        2   26    .    .    .  0.413 -390.668  135.891         0          0</span></span>
<span><span class="co">#&gt;        1    .    .    .    .  1.898 -281.774  244.784         0          0</span></span>
<span><span class="co">#&gt; Region score: 5</span></span></code></pre></div>
<p><strong>Models are ordered from best to worst fit</strong>. Here,
both AICc and BIC find the model with 5 regions as the best overall
model with the following regions: <em>region1</em>: vertebrae 8 to 23,
<em>region2</em>: vertebrae 24 to 27, <em>region3</em>: 28 to 34,
<em>region4</em>: 35 to 40, <em>region5</em>: 41 to 47.</p>
<p>In addition to returning the best models, the function also
calculates the <strong>region score</strong>, a continuous value
accounting for the fact models with different number of regions could
fit the data well. The region score is calculated as the sum of the
number of region in each model weighted by their respective AICc/BIC
weight. In this example, the region score for BIC is calculated as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>*</mo><mn>1</mn><mo>+</mo><mn>4</mn><mo>*</mo><mn>0</mn><mo>+</mo><mn>3</mn><mo>*</mo><mn>0</mn><mo>+</mo><mn>2</mn><mo>*</mo><mn>0</mn><mo>+</mo><mn>1</mn><mo>*</mo><mn>0</mn><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">5*1 + 4*0 + 3*0 + 2*0 + 1*0=5</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="adding-more-regions">Adding more regions<a class="anchor" aria-label="anchor" href="#adding-more-regions"></a>
</h3>
<p>In the example above, the model with 5 regions is by far the best one
(AICc/BIC weight = 1). In such cases where the most complex model is the
best model, it’s likely that more complex models fit the data better.
<code><a href="../reference/calcregions.html">addregions()</a></code> allows one to <strong>fit additional models
without the need to recompute models with fewer regions</strong>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regionresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">addregions</a></span><span class="op">(</span><span class="va">regionresults</span>, noregions <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">7</span>, exhaus <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">regionresults</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Regions Possible Tested  Saved Comp. method Saving method</span></span>
<span><span class="co">#&gt;        1        1      1      1   Exhaustive           All</span></span>
<span><span class="co">#&gt;        2       35     35     35   Exhaustive           All</span></span>
<span><span class="co">#&gt;        3      528    528    528   Exhaustive           All</span></span>
<span><span class="co">#&gt;        4     4495   4495   4495   Exhaustive           All</span></span>
<span><span class="co">#&gt;        5    23751  23751  23751   Exhaustive           All</span></span>
<span><span class="co">#&gt;        6    80730  80730  80730   Exhaustive           All</span></span>
<span><span class="co">#&gt;        7   177100 177100 177100   Exhaustive           All</span></span></code></pre></div>
<p>Identifying the best model now that models with 6 and 7 regions have
been added:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">regionresults</span><span class="op">)</span></span>
<span><span class="va">supp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span>
<span><span class="va">supp</span></span>
<span><span class="co">#&gt; - Model support (AICc)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 BP 5 BP 6 sumRSS     AICc deltaAIC model_lik</span></span>
<span><span class="co">#&gt;        7   19   24   27   35   38   41  0.021 -596.668    0.000     1.000</span></span>
<span><span class="co">#&gt;        6   19   24   27   34   40    .  0.026 -590.493    6.174     0.046</span></span>
<span><span class="co">#&gt;        5   23   27   34   40    .    .  0.046 -556.036   40.632     0.000</span></span>
<span><span class="co">#&gt;        4   23   30   40    .    .    .  0.073 -528.096   68.572     0.000</span></span>
<span><span class="co">#&gt;        3   23   29    .    .    .    .  0.147 -480.952  115.715     0.000</span></span>
<span><span class="co">#&gt;        2   26    .    .    .    .    .  0.413 -405.787  190.881     0.000</span></span>
<span><span class="co">#&gt;        1    .    .    .    .    .    .  1.898 -290.769  305.899     0.000</span></span>
<span><span class="co">#&gt;  Ak_weight</span></span>
<span><span class="co">#&gt;      0.956</span></span>
<span><span class="co">#&gt;      0.044</span></span>
<span><span class="co">#&gt;      0.000</span></span>
<span><span class="co">#&gt;      0.000</span></span>
<span><span class="co">#&gt;      0.000</span></span>
<span><span class="co">#&gt;      0.000</span></span>
<span><span class="co">#&gt;      0.000</span></span>
<span><span class="co">#&gt; Region score: 6.96 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Model support (BIC)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 BP 5 BP 6 sumRSS      BIC deltaBIC model_lik</span></span>
<span><span class="co">#&gt;        7   19   24   27   35   38   41  0.021 -562.017    0.000     1.000</span></span>
<span><span class="co">#&gt;        6   19   24   27   34   40    .  0.026 -557.902    4.116     0.128</span></span>
<span><span class="co">#&gt;        5   23   27   34   40    .    .  0.046 -526.559   35.459     0.000</span></span>
<span><span class="co">#&gt;        4   23   30   40    .    .    .  0.073 -502.645   59.373     0.000</span></span>
<span><span class="co">#&gt;        3   23   29    .    .    .    .  0.147 -460.321  101.697     0.000</span></span>
<span><span class="co">#&gt;        2   26    .    .    .    .    .  0.413 -390.668  171.349     0.000</span></span>
<span><span class="co">#&gt;        1    .    .    .    .    .    .  1.898 -281.774  280.243     0.000</span></span>
<span><span class="co">#&gt;  BIC_weight</span></span>
<span><span class="co">#&gt;       0.887</span></span>
<span><span class="co">#&gt;       0.113</span></span>
<span><span class="co">#&gt;       0.000</span></span>
<span><span class="co">#&gt;       0.000</span></span>
<span><span class="co">#&gt;       0.000</span></span>
<span><span class="co">#&gt;       0.000</span></span>
<span><span class="co">#&gt;       0.000</span></span>
<span><span class="co">#&gt; Region score: 6.89</span></span></code></pre></div>
<p>The best overall model now is the model with 7 regions both when
using AICc and BIC. Since the best model is still the most complex
model, additional model(s) with more than seven regions should be fitted
(not run here for computational reasons).</p>
</div>
<div class="section level3">
<h3 id="model-performance-r2">Model performance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>)<a class="anchor" aria-label="anchor" href="#model-performance-r2"></a>
</h3>
<p><code><a href="../reference/modelperf.html">modelperf()</a></code> returns the univariate (for each PC axis
individually) and multivariate (all PC axes)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
and adjusted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
for a given model. The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
can be calculated for the best model (<code>model = 1</code>) for a
given criterion (<code>criterion</code> argument), but also the second
best (<code>model = 2</code>), third best (<code>model = 3</code>), etc.
In this case, the output of <code><a href="../reference/modelsupport.html">modelsupport()</a></code> must be
supplied.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelperf.html">modelperf</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>, modelsupport <span class="op">=</span> <span class="va">supp</span>,</span>
<span>          criterion <span class="op">=</span> <span class="st">"bic"</span>, model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Breakpoints: 19, 24, 27, 35, 38, 41 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Univariate:</span></span>
<span><span class="co">#&gt;          R² Adj. R²</span></span>
<span><span class="co">#&gt; PCO.1 0.996   0.995</span></span>
<span><span class="co">#&gt; PCO.2 0.982   0.978</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Multivariate:</span></span>
<span><span class="co">#&gt;      R² Adj. R² </span></span>
<span><span class="co">#&gt;   0.993   0.992</span></span></code></pre></div>
<p>Alternatively, it is also possible to calculate the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
for a user-defined model using the <code>bps</code> argument specifying
the position of breakpoints (region boundaries) of the model to
test.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelperf.html">modelperf</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>          bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">24</span>, <span class="fl">37</span><span class="op">)</span>, criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Breakpoints: 15, 24, 37 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Univariate:</span></span>
<span><span class="co">#&gt;          R² Adj. R²</span></span>
<span><span class="co">#&gt; PCO.1 0.970   0.966</span></span>
<span><span class="co">#&gt; PCO.2 0.646   0.606</span></span>
<span><span class="co">#&gt; PCO.3 0.682   0.646</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Multivariate:</span></span>
<span><span class="co">#&gt;      R² Adj. R² </span></span>
<span><span class="co">#&gt;   0.901   0.890</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="breakpoint-position-variability">Breakpoint position variability<a class="anchor" aria-label="anchor" href="#breakpoint-position-variability"></a>
</h3>
<p><code><a href="../reference/calcBPvar.html">calcBPvar()</a></code> calculates the variability in breakpoint
position for a given number of regions (<code>noregions</code> argument)
using weighted means and standard deviation based either on AICc or BIC
weight (defined by <code>criterion</code> argument). The variability can
be calculated on a given proportion of best models across all fitted
models from this number of regions (<code>pct</code> argument).</p>
<p>Here is an example of calculating the variability of breakpoint
positions for models with 7 regions, using the top 10% best models
evaluated with the BIC criterion.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bpvar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcBPvar.html">calcBPvar</a></span><span class="op">(</span><span class="va">regionresults</span>, noregions <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                   pct <span class="op">=</span> <span class="fl">0.1</span>, criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span><span class="va">bpvar</span></span>
<span><span class="co">#&gt;         BP 1   BP 2   BP 3   BP 4   BP 5   BP 6</span></span>
<span><span class="co">#&gt; wMean 19.214 23.973 26.983 34.911 37.965 41.017</span></span>
<span><span class="co">#&gt; wSD    0.693  0.347  0.227  0.645  0.349  0.238</span></span>
<span><span class="co">#&gt; - Computed using top 10% of models</span></span></code></pre></div>
<p>Note that when using output from <code>calcBPvar</code> for plotting,
breakpoint positions will be rounded to the closest whole number. In the
example above, breakpoints will then be 19, 24, 26, 35, 38, and 41.
Since <code>calcregions</code> only returns whole numbers as breakpoint
values, a weighted mean breakpoint position of 23.97 involves that most
models found a breakpoint value of 24 (corresponding to a region break
between vertebrae 24 and 25).</p>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-results">Visualizing results<a class="anchor" aria-label="anchor" href="#visualizing-results"></a>
</h2>
<p><em>MorphoRegions</em> offers two main plotting options to visualize
the results: 1) scatter plots showing PC scores of each element
(vertebra) along the structure (backbone) and the segmented linear
regressions, 2) vertebral maps showing the regional identity of each
element (vertebra).</p>
<div class="section level3">
<h3 id="segmented-linear-regression-plots">Segmented linear regression plots<a class="anchor" aria-label="anchor" href="#segmented-linear-regression-plots"></a>
</h3>
<p>The scatter plots of the segmented linear regressions can be plotted
using <code><a href="../reference/plotsegreg.html">plotsegreg()</a></code>. The output of <code><a href="../reference/svdPCO.html">svdPCO()</a></code> and
the number of the PC axis to plot (<code>scores</code> argument) must be
supplied.</p>
<p>The function can either be used to plot the best (or second best,
third best, etc.) model (<code>model</code> argument) for a given
criterion, by supplying the output of <code><a href="../reference/modelsupport.html">modelsupport()</a></code>.
Alternatively, a specific model can also be plotted by providing the
position of the breakpoints (<code>bps</code> argument).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot regressions for best model:</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>           modelsupport <span class="op">=</span> <span class="va">supp</span>,</span>
<span>           criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>           model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot regressions for a specific model:</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>           bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">24</span>, <span class="fl">37</span><span class="op">)</span>,</span>
<span>           cont <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-21-1.png" alt="**Fig.5.** Scatterplots showing PCO scores and segmented regressions on PC1 and PC2 for the best model *(left)* and on PC1 for a 4 regions model with breakpoints at vertebrae 15, 24, and 37 *(right)*." width="48%"><img src="MorphoRegions_files/figure-html/unnamed-chunk-21-2.png" alt="**Fig.5.** Scatterplots showing PCO scores and segmented regressions on PC1 and PC2 for the best model *(left)* and on PC1 for a 4 regions model with breakpoints at vertebrae 15, 24, and 37 *(right)*." width="48%"><p class="caption">
<strong>Fig.5.</strong> Scatterplots showing PCO scores and segmented
regressions on PC1 and PC2 for the best model <em>(left)</em> and on PC1
for a 4 regions model with breakpoints at vertebrae 15, 24, and 37
<em>(right)</em>.
</p>
</div>
</div>
<div class="section level3">
<h3 id="vertebral-maps">Vertebral maps<a class="anchor" aria-label="anchor" href="#vertebral-maps"></a>
</h3>
<p><code><a href="../reference/plotvertmap.html">plotvertmap()</a></code> produces vertebral maps, which are plots
in which each rectangle corresponds to an element (i.e., vertebra) that
is color-coded according to the region to which it belongs. The function
provides many different plotting options.</p>
<p>The function requires <code>regions_data</code> (from
<code><a href="../reference/process_measurements.html">process_measurements()</a></code>), <code>regions_pco</code> (from
<code><a href="../reference/svdPCO.html">svdPCO()</a></code>), or <code>regions_sims</code> (from
<code><a href="../reference/simregions.html">simregions()</a></code>; see below) to be provided. The positional
information of each element (i.e., vertebral number) will be extracted
from one of these objects.</p>
<p>The regional identity of each element can be defined either by
providing a <code>regions_modelsupport</code> object (from
<code><a href="../reference/modelsupport.html">modelsupport()</a></code>) or by directly specifying the position of
breakpoints of a model.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Plot vertebral map using best BPs from modelsupport (BIC)</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin A"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>, criterion <span class="op">=</span> <span class="st">"bic"</span>, model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot vertebral map using 2nd best BPs from modelsupport (AICc)</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin B"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>, criterion <span class="op">=</span> <span class="st">"aic"</span>, model <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot vertebral map using arbitrary breakpoints</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin C"</span>,</span>
<span>            bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">17</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-22-1.png" alt="**Fig.6.** Vertebral maps of the best fit model using BIC criterion *(top)*, the 2^nd^ best fit model using AICc criterion *(middle)*, a user-defined model with breakpoints at vertebrae 12, 17, 20, and 30 *(bottom)*." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-22-2.png" alt="**Fig.6.** Vertebral maps of the best fit model using BIC criterion *(top)*, the 2^nd^ best fit model using AICc criterion *(middle)*, a user-defined model with breakpoints at vertebrae 12, 17, 20, and 30 *(bottom)*." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-22-3.png" alt="**Fig.6.** Vertebral maps of the best fit model using BIC criterion *(top)*, the 2^nd^ best fit model using AICc criterion *(middle)*, a user-defined model with breakpoints at vertebrae 12, 17, 20, and 30 *(bottom)*." width="672"><p class="caption">
<strong>Fig.6.</strong> Vertebral maps of the best fit model using BIC
criterion <em>(top)</em>, the 2<sup>nd</sup> best fit model using AICc
criterion <em>(middle)</em>, a user-defined model with breakpoints at
vertebrae 12, 17, 20, and 30 <em>(bottom)</em>.
</p>
</div>
<p>Here the seven first elements (rectangles corresponding each to one
vertebra) are grayed as they were not included in the analyses. It is
possible to hide elements excluded from the analyses by setting the
<code>dropNA</code> argument to <code>TRUE</code>.</p>
<p><strong>Variability in breakpoint positions</strong> between regions
can also be added either by supplying a <code>regions_BPvar</code>
object (from <code><a href="../reference/calcBPvar.html">calcBPvar()</a></code>) or a user-defined vector. When a
<code>regions_BPvar</code> object is supplied, the position of
breakpoints corresponds to the weighted mean position computed by
<code><a href="../reference/calcBPvar.html">calcBPvar()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BP variability from calcBPvar:</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>,</span>
<span>           bpvar <span class="op">=</span> <span class="va">bpvar</span>, dropNA <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BP variability from user-defined vector, plotting SD bars in grey:</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>,</span>
<span>            criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>            bp.sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.2</span>, <span class="fl">1.4</span>, <span class="fl">2.5</span>, <span class="fl">1.5</span>, <span class="fl">2.1</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>            sd.col<span class="op">=</span><span class="st">"#636363"</span>, dropNA <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-23-1.png" alt="**Fig.7.** Vertebral maps showing breakpoint position variability calculated from *calcBPvar (top)* and with values directly supplied to the function *(bottom)*. Dots correspond to breakpoint position and horizontal lines correspond to the standard deviation of each breakpoint position." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-23-2.png" alt="**Fig.7.** Vertebral maps showing breakpoint position variability calculated from *calcBPvar (top)* and with values directly supplied to the function *(bottom)*. Dots correspond to breakpoint position and horizontal lines correspond to the standard deviation of each breakpoint position." width="672"><p class="caption">
<strong>Fig.7.</strong> Vertebral maps showing breakpoint position
variability calculated from <em>calcBPvar (top)</em> and with values
directly supplied to the function <em>(bottom)</em>. Dots correspond to
breakpoint position and horizontal lines correspond to the standard
deviation of each breakpoint position.
</p>
</div>
<p>To facilitate the interpretation of the regions, the function offers
some plotting options.</p>
<p>It is possible to <strong>add other boundaries on the plot</strong>,
such as the boundaries between traditional anatomical regions
(thoraco-lumbar, lumbo-caudal, etc). Boundary positions can be supplied
as a vector to the <code>reg.lim</code> argument, with each numeric
value corresponding to the position of the last element before the
boundary. For example, in the dolphin dataset, the thoraco-lumbar,
lumbo-caudal, and caudal-fluke transitions fall between vertebrae 17-18,
25-26, and 35-36, respectively.</p>
<p>It is also possible to plot the <strong>positional info</strong> of
each element (vertebra) as a number on the corresponding rectangle.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove missing vertebrae, add vertebrae number </span></span>
<span>  <span class="co"># and add thoraco-lumbar, lumbo-caudal, and caudal-fluke boundaries:</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>, modelsupport <span class="op">=</span> <span class="va">supp</span>,</span>
<span>            criterion <span class="op">=</span> <span class="st">"bic"</span>, dropNA <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            reg.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span> ,<span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span>,</span>
<span>            lim.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add positional info of each vertebra:</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>, modelsupport <span class="op">=</span> <span class="va">supp</span>,</span>
<span>            criterion <span class="op">=</span> <span class="st">"bic"</span>, dropNA <span class="op">=</span> <span class="cn">TRUE</span>, text <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-24-1.png" alt="**Fig.8.** Vertebral maps with anatomical region boundaries represented by vertical bars *(top)* and vertebral position labelled on corresponding rectangle *(bottom)*." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-24-2.png" alt="**Fig.8.** Vertebral maps with anatomical region boundaries represented by vertical bars *(top)* and vertebral position labelled on corresponding rectangle *(bottom)*." width="672"><p class="caption">
<strong>Fig.8.</strong> Vertebral maps with anatomical region boundaries
represented by vertical bars <em>(top)</em> and vertebral position
labelled on corresponding rectangle <em>(bottom)</em>.
</p>
</div>
<p>By default, the function plots the elements (vertebrae) as count
(vertebral count) but it is also possible to <strong>plot elements as
percentage of the total number of elements</strong> (by setting
<code>type = "percent"</code>).</p>
<p>In both cases, each element on the plot will have the same size.
Alternatively, it is possible to <strong>scale rectangles on the plot
according to the relative size of each element</strong> by supplying a
vector containing size information to the <code>centraL</code> argument.
In the example below, rectangles are scaled according to the centrum
length of each vertebra (supplied in the <code>Lc</code> column of the
original dataset).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot vertebrae as percentage of total count:</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"percent"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>, criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>            dropNA <span class="op">=</span> <span class="cn">TRUE</span>, reg.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scale vertebrae relative to their centrum length (scale in cm):</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"count"</span>, centraL <span class="op">=</span> <span class="st">"Lc"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>, criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>            dropNA <span class="op">=</span> <span class="cn">TRUE</span>, reg.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scale vertebrae relative to their centrum length (scale in % total length):</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"percent"</span>, centraL <span class="op">=</span> <span class="st">"Lc"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>, criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>            dropNA <span class="op">=</span> <span class="cn">TRUE</span>, reg.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span>,</span>
<span>            lim.col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-25-1.png" alt="**Fig.9.** Vertebral maps plotting vertebrae as percentage of total vertebral count *(top)*, scaled to their centrum length relative to total length in absolute value *(middle)*, and scaled to their centrum length in percentage *(bottom)*." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-25-2.png" alt="**Fig.9.** Vertebral maps plotting vertebrae as percentage of total vertebral count *(top)*, scaled to their centrum length relative to total length in absolute value *(middle)*, and scaled to their centrum length in percentage *(bottom)*." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-25-3.png" alt="**Fig.9.** Vertebral maps plotting vertebrae as percentage of total vertebral count *(top)*, scaled to their centrum length relative to total length in absolute value *(middle)*, and scaled to their centrum length in percentage *(bottom)*." width="672"><p class="caption">
<strong>Fig.9.</strong> Vertebral maps plotting vertebrae as percentage
of total vertebral count <em>(top)</em>, scaled to their centrum length
relative to total length in absolute value <em>(middle)</em>, and scaled
to their centrum length in percentage <em>(bottom)</em>.
</p>
</div>
<p>Finally, it is possible to <strong>change colors used for each
region</strong> with the <code>block.cols</code> argument. Colors can
either be supplied as a vector, in which case regions will be
<em>color-coded following the order of colors supplied in the
vector</em>.</p>
<p>Alternatively, it’s also possible to <em>define a set of colors per
block</em>, each block being defined by the <code>block.lim</code>
argument. In this case, colors must be supplied as a named list, each
element of the list containing a vector of color for a given block. For
instance, for the dolphin data, we could define regions in the precaudal
block (thoracic + lumbar) to be colors in shades of beige/brown, while
regions in the caudal block (caudal + fluke) to be color in shades of
blue. Since the lumbo-caudal transition falls between vertebrae 25 and
26, we’ll define two blocks with a limit at vertebra 25.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manually color-coding each region using the viridis palette:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/" class="external-link">viridisLite</a></span><span class="op">)</span></span>
<span><span class="va">nreg</span> <span class="op">&lt;-</span> <span class="va">supp</span><span class="op">$</span><span class="va">Model_support_BIC</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>  <span class="co"># get nbr of regions</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nreg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"percent"</span>, centraL <span class="op">=</span> <span class="st">"Lc"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>, criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>            dropNA <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            reg.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span>,</span>
<span>            block.cols <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Color code regions by block (precaudal vs caudal):</span></span>
<span><span class="va">blockcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>PreCaudal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#BF812D"</span>,<span class="st">"#8C510A"</span>,<span class="st">"#543005"</span><span class="op">)</span>,</span>
<span>                  Caudal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#C7EAE5"</span>,<span class="st">"#80CDC1"</span>,<span class="st">"#35978F"</span>,<span class="st">"#01665E"</span>,<span class="st">"#236E30"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"percent"</span>, centraL <span class="op">=</span> <span class="st">"Lc"</span>,</span>
<span>            modelsupport <span class="op">=</span> <span class="va">supp</span>, criterion <span class="op">=</span> <span class="st">"bic"</span>,</span>
<span>            dropNA <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            reg.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span>,</span>
<span>            block.cols <span class="op">=</span> <span class="va">blockcols</span>, block.lim <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-26-1.png" alt="**Fig.10.** Vertebral maps with regions colored with a user-defined palette using *viridis* *(top)* and custom palettes for different blocks *(bottom)*." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-26-2.png" alt="**Fig.10.** Vertebral maps with regions colored with a user-defined palette using *viridis* *(top)* and custom palettes for different blocks *(bottom)*." width="672"><p class="caption">
<strong>Fig.10.</strong> Vertebral maps with regions colored with a
user-defined palette using <em>viridis</em> <em>(top)</em> and custom
palettes for different blocks <em>(bottom)</em>.
</p>
</div>
<p><em>When coloring regions by blocks, regions spanning over more than
one block will be allocated to the block in which the majority of its
elements belong. In the example above, the 3<sup>rd</sup> region has one
vertebra in the precaudal block and two in the caudal block, thus this
region is considered as the 1<sup>st</sup> region in the caudal
block.</em></p>
<p>Vertebral maps are created using <em>ggplot2</em> meaning that they
can be modified similarly to <code>ggplot</code> plots. For instance, it
is possible to create a single plot with multiple vertebral maps with
the <em>patchwork</em> package.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run regions analysis on alligator and mouse data:</span></span>
<span><span class="va">dat_alligator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_measurements.html">process_measurements</a></span><span class="op">(</span><span class="va">alligator</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pco_alligator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svdPCO.html">svdPCO</a></span><span class="op">(</span><span class="va">dat_alligator</span>, <span class="st">"gower"</span><span class="op">)</span></span>
<span><span class="va">regions_alligator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">pco_alligator</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                                 noregions <span class="op">=</span> <span class="fl">5</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">supp_alligator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">regions_alligator</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_mouse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_measurements.html">process_measurements</a></span><span class="op">(</span><span class="va">musm</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pco_mouse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svdPCO.html">svdPCO</a></span><span class="op">(</span><span class="va">dat_mouse</span>, <span class="st">"gower"</span><span class="op">)</span></span>
<span><span class="va">regions_mouse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">pco_mouse</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                             noregions <span class="op">=</span> <span class="fl">5</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">supp_mouse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">regions_mouse</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create vertebral maps:</span></span>
<span><span class="va">vertmaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alligator <span class="op">=</span> <span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">pco_alligator</span>, name <span class="op">=</span> <span class="st">"Alligator"</span>, centraL <span class="op">=</span> <span class="st">"CL"</span>,</span>
<span>                                         modelsupport <span class="op">=</span> <span class="va">supp_alligator</span>, type <span class="op">=</span> <span class="st">"percent"</span>,</span>
<span>                                         dropNA <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 mouse <span class="op">=</span> <span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">pco_mouse</span>, name <span class="op">=</span> <span class="st">"Mouse"</span>, centraL<span class="op">=</span> <span class="st">"CL"</span>, </span>
<span>                                     modelsupport <span class="op">=</span> <span class="va">supp_mouse</span>, type <span class="op">=</span> <span class="st">"percent"</span>,</span>
<span>                                     dropNA <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 dolphin <span class="op">=</span> <span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, name <span class="op">=</span> <span class="st">"Dolphin"</span>, centraL<span class="op">=</span> <span class="st">"Lc"</span>,</span>
<span>                                       modelsupport <span class="op">=</span> <span class="va">supp</span>, type <span class="op">=</span> <span class="st">"percent"</span>,</span>
<span>                                       dropNA <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove x axis for plots except bottom one:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">vertmaps</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vertmaps</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">vertmaps</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">vertmaps</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                         axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                         axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Stack plots together:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">vertmaps</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-27-1.png" alt="**Fig.11.** Vertebral maps of alligator, mouse, and dolphin stacked in a single figure." width="672"><p class="caption">
<strong>Fig.11.</strong> Vertebral maps of alligator, mouse, and dolphin
stacked in a single figure.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="FittingOptions">Model fitting parameters<a class="anchor" aria-label="anchor" href="#FittingOptions"></a>
</h2>
<p>As briefly described in the <a href="#SegRegFit">section above</a>,
there are several different parameters available when fitting the
segmented linear regressions.</p>
<div class="section level3">
<h3 id="ContDisc">Continuous <em>vs.</em> discontinuous fit<a class="anchor" aria-label="anchor" href="#ContDisc"></a>
</h3>
<p>While the older <em>regions</em> package automatically fitted
discontinuous segments, <em>MorphoRegions</em> allows users to choose
between a continuous or discontinuous fit. In a continuous fit, the
first point of the segment aligns with the last point of the preceding
segment, modeling gradational variation without large jumps between
segments. Because the continuous fit forces continuity between
successive segments, it puts more constrains on the model fitting
compared to a discontinuous fit. Depending on the dataset, one or the
other fitting method might be appropriate. It’s advised to visually
inspect the distributions of elements along the structure using the PCO
scores that will be implemented in the analysis (as in <a href="#PCO">Fig.2</a>) before choosing an option.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot a discontinuous model:</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>           bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">24</span>, <span class="fl">37</span><span class="op">)</span>,</span>
<span>           cont <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot a continuous model:</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>           bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">24</span>, <span class="fl">37</span><span class="op">)</span>,</span>
<span>           cont <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-28-1.png" alt="**Fig.12.** Best fit on PCOs 1 and 2 of a 4 region models with breakpoints at 15, 24, and 37, using a discontinuous model (*left*) and a continuous model (*right*)." width="48%"><img src="MorphoRegions_files/figure-html/unnamed-chunk-28-2.png" alt="**Fig.12.** Best fit on PCOs 1 and 2 of a 4 region models with breakpoints at 15, 24, and 37, using a discontinuous model (*left*) and a continuous model (*right*)." width="48%"><p class="caption">
<strong>Fig.12.</strong> Best fit on PCOs 1 and 2 of a 4 region models
with breakpoints at 15, 24, and 37, using a discontinuous model
(<em>left</em>) and a continuous model (<em>right</em>).
</p>
</div>
</div>
<div class="section level3">
<h3 id="MinVert">Minimum number of elements per region<a class="anchor" aria-label="anchor" href="#MinVert"></a>
</h3>
<p>By default, the minimum number of elements (vertebrae) in each region
is set to 3. This parameter can, however, be changed with the
<code>minvert</code> argument in the <code>calcregions</code> function.
<em>Note that setting the minimum value to 2 might results in linear
segments made of only two points, which will have a perfect fit (RSS=0
for these segments) and might artificially increase the goodness of
fit.</em></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fitting up to 5 regions for alligator data with 2 vertebrae minimum per segment:</span></span>
<span><span class="va">reg.all.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">pco_alligator</span>, scores <span class="op">=</span> <span class="fl">1</span>, minvert <span class="op">=</span> <span class="fl">2</span>, noregions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                         cont <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">pco_alligator</span>, scores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>           modelsupport <span class="op">=</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">reg.all.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fitting up to 5 regions for alligator data with 4 vertebrae minimum per segment:</span></span>
<span><span class="va">reg.all.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">pco_alligator</span>, scores <span class="op">=</span> <span class="fl">1</span>, minvert <span class="op">=</span> <span class="fl">4</span>, noregions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                         cont <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">pco_alligator</span>, scores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>           modelsupport <span class="op">=</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">reg.all.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-29-1.png" alt="**Fig.13.** Best fit on PCO 1 of models up to 5 regions with a minimum of 2 vertebrae per region (*left*) or 4 vertebrae per region (*right*)." width="48%"><img src="MorphoRegions_files/figure-html/unnamed-chunk-29-2.png" alt="**Fig.13.** Best fit on PCO 1 of models up to 5 regions with a minimum of 2 vertebrae per region (*left*) or 4 vertebrae per region (*right*)." width="48%"><p class="caption">
<strong>Fig.13.</strong> Best fit on PCO 1 of models up to 5 regions
with a minimum of 2 vertebrae per region (<em>left</em>) or 4 vertebrae
per region (<em>right</em>).
</p>
</div>
<p>When setting the minimum number of vertebrae per region to 2, the
best fit model (using BIC) is the 5 regions model with RSS = 0.001 and
BIC weight = 0.99.</p>
<p>When forcing the minimum number of vertebrae per region to 4, the
best fit model (using BIC) is the 4 regions model with RSS = 0.002 and
BIC weight = 0.61. The 5 regions model is only the 3<sup>rd</sup> best
model (after the 3 regions model) with RSS = 0.002 and BIC weight =
0.02.</p>
</div>
<div class="section level3">
<h3 id="ForceBP">Forcing or preventing specific breakpoint positions<a class="anchor" aria-label="anchor" href="#ForceBP"></a>
</h3>
<p>The <code>omitbp</code> and <code>includebp</code> arguments of
<code>calcregions</code> allows one to prevent or force breakpoint(s) at
specific position(s), respectively.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit models for dolphin preventing any BP in the thoracic and lumbar regions:</span></span>
<span><span class="va">reg.dol.noBP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>, noregions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                            omitbp <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">25</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>,</span>
<span>           modelsupport <span class="op">=</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">reg.dol.noBP</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit models for dolphin forcing BPs at anatomical region boundaries:</span></span>
<span><span class="va">reg.dol.forceBP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>, noregions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                               includebp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores<span class="op">=</span><span class="va">PCOs</span>,</span>
<span>           modelsupport <span class="op">=</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">reg.dol.forceBP</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-30-1.png" alt="**Fig.14.** Best fit on PCO 1 and 2 of models up to 5 regions preventing any breakpoint in the thoraco-lumbar region (vertebrae 8 to 25) *(top)*  and forcing breakpoints at anatomical region boundaries (vertebrae 17, 25, 35) *(bottom)*." width="48%"><img src="MorphoRegions_files/figure-html/unnamed-chunk-30-2.png" alt="**Fig.14.** Best fit on PCO 1 and 2 of models up to 5 regions preventing any breakpoint in the thoraco-lumbar region (vertebrae 8 to 25) *(top)*  and forcing breakpoints at anatomical region boundaries (vertebrae 17, 25, 35) *(bottom)*." width="48%"><p class="caption">
<strong>Fig.14.</strong> Best fit on PCO 1 and 2 of models up to 5
regions preventing any breakpoint in the thoraco-lumbar region
(vertebrae 8 to 25) <em>(top)</em> and forcing breakpoints at anatomical
region boundaries (vertebrae 17, 25, 35) <em>(bottom)</em>.
</p>
</div>
</div>
<div class="section level3">
<h3 id="Exhaus">Exhaustive <em>vs.</em> non-exhaustive search<a class="anchor" aria-label="anchor" href="#Exhaus"></a>
</h3>
<p><em>MorphoRegions</em> has been implemented to fit numerous models
efficiently enough to run in a few minutes on most computers. However,
in the case of quite complex models (numerous elements, regions to fit,
and/or PCO scores), computational time can quickly increase. To speed up
the process, it is possible to fit models in a non-exhaustive way by
setting <code>exhaus = FALSE</code> in <code><a href="../reference/calcregions.html">calcregions()</a></code>.</p>
<p>When a non-exhaustive search is used, all possible models for 1 and 2
regions models are fitted, but for 3 and more regions, the algorithm
will only fit a subset of all the possible models. For a given number of
regions,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
the optimal positions of breakpoints of the models with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math>
regions are used as a starting point to define the subset of models to
fit.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg.dol.Nex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>, noregions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                           exhaus <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">reg.dol.Nex</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Regions Possible Tested Saved Comp. method Saving method</span></span>
<span><span class="co">#&gt;        1        1      1     1   Exhaustive           All</span></span>
<span><span class="co">#&gt;        2       35     35    35   Exhaustive           All</span></span>
<span><span class="co">#&gt;        3      528    528   115   Non-exhaus          SD/2</span></span>
<span><span class="co">#&gt;        4     4495   3220   421   Non-exhaus          SD/2</span></span>
<span><span class="co">#&gt;        5    23751  11648   424   Non-exhaus          SD/2</span></span></code></pre></div>
<p>In a non-exhaustive search, the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function used
on <code><a href="../reference/calcregions.html">calcregions()</a></code> returns, for each number of regions, the
total number of possible models, the number of models actually fitted,
and the number of models saved to output in order to limit memory
usage.</p>
<p>If the variability of breakpoint positions is calculated on
non-exhaustive search output, the proportion of best models used to
calculate the variability corresponds to the given percentage of all
possible models. It’s therefore possible that in some cases the number
of models saved by the non-exhaustive search is lower than the requested
percentage. In such cases, the variability will be calculated on all
saved models and a warning message is returned.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calcBPvar.html">calcBPvar</a></span><span class="op">(</span><span class="va">reg.dol.Nex</span>, noregions <span class="op">=</span> <span class="fl">5</span>, pct <span class="op">=</span> <span class="fl">0.1</span>, criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Number of models provided lower than percentage requested.</span></span>
<span><span class="co">#&gt; Weighted means and SD calculated on: 1.79% of total number of models.</span></span>
<span><span class="co">#&gt;         BP 1   BP 2   BP 3   BP 4</span></span>
<span><span class="co">#&gt; wMean 23.154 27.354 33.985 39.722</span></span>
<span><span class="co">#&gt; wSD    0.524  0.509  0.677  0.630</span></span>
<span><span class="co">#&gt; - Computed using top 1.79% of models</span></span></code></pre></div>
<p>Because average and variability of breakpoint position is calculated
using weighted means and SD, respectively, results usually remain
similar to those obtained using full top 10% (models fitted with an
exhaustive search) unless there are numerous models which fit the data
well.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calcBPvar.html">calcBPvar</a></span><span class="op">(</span><span class="va">regionresults</span>, noregions <span class="op">=</span> <span class="fl">5</span>, pct <span class="op">=</span> <span class="fl">0.1</span>, criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         BP 1   BP 2   BP 3   BP 4</span></span>
<span><span class="co">#&gt; wMean 23.154 27.354 33.985 39.722</span></span>
<span><span class="co">#&gt; wSD    0.524  0.509  0.678  0.630</span></span>
<span><span class="co">#&gt; - Computed using top 10% of models</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="Para">Parallel computing<a class="anchor" aria-label="anchor" href="#Para"></a>
</h3>
<p>For specimens with a high number of elements and/or numerous regions
and for which computing non-exhaustive searches are still time
consuming, the <code>cl</code> argument in <code><a href="../reference/calcregions.html">calcregions()</a></code>
allows one to implement parallel computing. See the <code>cl</code>
argument to <code><a href="https://rdrr.io/pkg/pbapply/man/pbapply.html" class="external-link">pbapply::pblapply()</a></code> for more details on how it
can be specified. Below, we request 6 cores to be used (supplying a
number is not available on Windows).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Exhaustive search with parallel computing using 6 cores:</span></span>
<span><span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">2</span>, noregions <span class="op">=</span> <span class="fl">10</span>, exhaus <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            cl <span class="op">=</span> <span class="fl">6</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Note that parallel computing will only be significantly faster on
heavy computing specimens.</p>
</div>
</div>
<div class="section level2">
<h2 id="IntraSp">Intrapsecific variability<a class="anchor" aria-label="anchor" href="#IntraSp"></a>
</h2>
<p>To account for variability within a species or group, it is possible
to <strong>run the regionalization analysis on multiple specimens in a
single analysis</strong>. The <code>porpoise</code> dataset contains
data of 3 different specimens of harbor porpoise.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"porpoise"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Elements</th>
<th align="right">Variables</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Porpoise 1</td>
<td align="right">58</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">Porpoise 2</td>
<td align="right">56</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">Porpoise 3</td>
<td align="right">59</td>
<td align="right">17</td>
</tr>
</tbody>
</table>
<p>The total number of elements (vertebrae) can differ among specimens,
but the number of variables and their order must be the same. The
highest number of elements is used to generate the vertebral map. In the
porpoise dataset, the first specimen has 58 post-cervical vertebrae, the
second has 56, and the third one has 59, but they all have 17 variables.
In the case of differing number of elements, homologous elements
(vertebrae) must be identified by the same number in the positional
information column of the data.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process measurements data</span></span>
<span><span class="va">porpoise_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_measurements.html">process_measurements</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">porpoise1</span>, <span class="va">porpoise2</span>, <span class="va">porpoise3</span><span class="op">)</span>, pos <span class="op">=</span> <span class="st">"Vertebra"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute PCOs</span></span>
<span><span class="va">porpoise_pco</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svdPCO.html">svdPCO</a></span><span class="op">(</span><span class="va">porpoise_data</span>, <span class="st">"gower"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot PCOs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">porpoise_pco</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">porpoise_pco</span>, pco_x <span class="op">=</span> <span class="fl">1</span>, pco_y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-37-1.png" alt="**Fig.15.** PCO plots of the three specimens of harbor porpoise." width="65%"><img src="MorphoRegions_files/figure-html/unnamed-chunk-37-2.png" alt="**Fig.15.** PCO plots of the three specimens of harbor porpoise." width="65%"><p class="caption">
<strong>Fig.15.</strong> PCO plots of the three specimens of harbor
porpoise.
</p>
</div>
<p>Once data of each specimen have been supplied to the
<code>process_measurements</code> function, <strong>the process to run
the analysis is similar to running the analysis on a single specimen at
a time</strong>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate number of PCOs to use in subsequent analyses</span></span>
<span><span class="va">PCOs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCOselect.html">PCOselect</a></span><span class="op">(</span><span class="va">porpoise_pco</span>, <span class="st">"variance"</span>, cutoff <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Performance for all models across all breakpoint combos</span></span>
<span><span class="va">regionresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">porpoise_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>,</span>
<span>                             noregions <span class="op">=</span> <span class="fl">3</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adding more models to existing results</span></span>
<span><span class="va">regionresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">addregions</a></span><span class="op">(</span><span class="va">regionresults</span>, noregions <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>                            exhaus <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select best model</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">regionresults</span><span class="op">)</span></span>
<span><span class="va">supp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span>
<span><span class="va">supp</span></span>
<span><span class="co">#&gt; - Model support (AICc)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 sumRSS      AICc deltaAIC model_lik Ak_weight</span></span>
<span><span class="co">#&gt;        5   18   33   38   53  0.105 -2769.304    0.000         1         1</span></span>
<span><span class="co">#&gt;        4   20   40   52    .  0.148 -2656.161  113.142         0         0</span></span>
<span><span class="co">#&gt;        3   21   39    .    .  0.293 -2426.584  342.720         0         0</span></span>
<span><span class="co">#&gt;        2   37    .    .    .  0.631 -2167.924  601.380         0         0</span></span>
<span><span class="co">#&gt;        1    .    .    .    .  2.155 -1749.033 1020.271         0         0</span></span>
<span><span class="co">#&gt; Region score: 5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Model support (BIC)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 sumRSS       BIC deltaBIC model_lik BIC_weight</span></span>
<span><span class="co">#&gt;        5   18   33   38   53  0.105 -2709.414    0.000         1          1</span></span>
<span><span class="co">#&gt;        4   20   40   52    .  0.148 -2607.254  102.160         0          0</span></span>
<span><span class="co">#&gt;        3   21   39    .    .  0.293 -2388.776  320.638         0          0</span></span>
<span><span class="co">#&gt;        2   37    .    .    .  0.631 -2141.330  568.084         0          0</span></span>
<span><span class="co">#&gt;        1    .    .    .    .  2.155 -1733.764  975.650         0          0</span></span>
<span><span class="co">#&gt; Region score: 5</span></span>
<span></span>
<span><span class="co"># Calculate variability of optimal breakpoints</span></span>
<span><span class="va">bpvar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcBPvar.html">calcBPvar</a></span><span class="op">(</span><span class="va">regionresults</span>, noregions <span class="op">=</span> <span class="fl">5</span>, pct <span class="op">=</span> <span class="fl">.05</span>,</span>
<span>                   criterion <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span></span>
<span><span class="va">bpvar</span></span>
<span><span class="co">#&gt;         BP 1   BP 2   BP 3   BP 4</span></span>
<span><span class="co">#&gt; wMean 18.014 33.124 37.695 52.655</span></span>
<span><span class="co">#&gt; wSD    0.651  0.510  0.461  0.493</span></span>
<span><span class="co">#&gt; - Computed using top 4.57% of models</span></span>
<span></span>
<span><span class="co"># Calculate model performance (R2) of best model</span></span>
<span><span class="fu"><a href="../reference/modelperf.html">modelperf</a></span><span class="op">(</span><span class="va">porpoise_pco</span>, scores <span class="op">=</span> <span class="va">PCOs</span>, modelsupport <span class="op">=</span> <span class="va">supp</span>,</span>
<span>          criterion <span class="op">=</span> <span class="st">"bic"</span>, model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Breakpoints: 18, 33, 38, 53 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Univariate:</span></span>
<span><span class="co">#&gt;          R² Adj. R²</span></span>
<span><span class="co">#&gt; PCO.1 0.984   0.983</span></span>
<span><span class="co">#&gt; PCO.2 0.936   0.935</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Multivariate:</span></span>
<span><span class="co">#&gt;      R² Adj. R² </span></span>
<span><span class="co">#&gt;   0.974   0.974</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot PCOs of best fit model</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">porpoise_pco</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, modelsupport <span class="op">=</span> <span class="va">supp</span>,</span>
<span>            criterion <span class="op">=</span> <span class="st">"bic"</span>, model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-39-1.png" alt="**Fig.16.** Best fit model (based on BIC) on PCO 1 and 2 calculated on the three harbor porpoise specimens." width="60%"><p class="caption">
<strong>Fig.16.</strong> Best fit model (based on BIC) on PCO 1 and 2
calculated on the three harbor porpoise specimens.
</p>
</div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot vertebral map of best fit model</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">porpoise_pco</span>, name <span class="op">=</span> <span class="st">"Porpoise"</span>, </span>
<span>            type <span class="op">=</span> <span class="st">"percent"</span>, centraL <span class="op">=</span> <span class="st">"Lc"</span>,</span>
<span>            reg.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">34</span>, <span class="fl">54</span><span class="op">)</span>, dropNA <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            bpvar <span class="op">=</span> <span class="va">bpvar</span>, sd.col <span class="op">=</span> <span class="st">"grey20"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-40-1.png" alt="**Fig.17.** Vertebral map of best fit model (including variance in breakpoint position) based on the three harbor porpoise specimens." width="672"><p class="caption">
<strong>Fig.17.</strong> Vertebral map of best fit model (including
variance in breakpoint position) based on the three harbor porpoise
specimens.
</p>
</div>
</div>
<div class="section level2">
<h2 id="other-useful-options">Other useful options<a class="anchor" aria-label="anchor" href="#other-useful-options"></a>
</h2>
<div class="section level3">
<h3 id="fit-a-specific-model">Fit a specific model<a class="anchor" aria-label="anchor" href="#fit-a-specific-model"></a>
</h3>
<p>Instead of fitting all possible models for a given range of region
number, <code><a href="../reference/calcmodel.html">calcmodel()</a></code> allows one to fit a single model with
user-defined breakpoint positions.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Fit a single breakpoints model</span></span>
<span><span class="va">regionsmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcmodel.html">calcmodel</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, cont <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">24</span>, <span class="fl">27</span>, <span class="fl">32</span>, <span class="fl">35</span>, <span class="fl">38</span>, <span class="fl">41</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">regionsmodel</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 BP 5 BP 6 BP 7 sumRSS RSS.1 RSS.2 RSS.3</span></span>
<span><span class="co">#&gt;        8   19   24   27   32   35   38   41  0.034  0.01  0.01 0.013</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Support:</span></span>
<span><span class="co">#&gt;      AICc       BIC </span></span>
<span><span class="co">#&gt; -885.1162 -818.3415</span></span>
<span></span>
<span><span class="co">#Evaluate performance (R2) on that model</span></span>
<span><span class="fu"><a href="../reference/modelperf.html">modelperf</a></span><span class="op">(</span><span class="va">regionsmodel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Breakpoints: 19, 24, 27, 32, 35, 38, 41 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Univariate:</span></span>
<span><span class="co">#&gt;          R² Adj. R²</span></span>
<span><span class="co">#&gt; PCO.1 0.996   0.995</span></span>
<span><span class="co">#&gt; PCO.2 0.983   0.978</span></span>
<span><span class="co">#&gt; PCO.3 0.904   0.879</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Multivariate:</span></span>
<span><span class="co">#&gt;      R² Adj. R² </span></span>
<span><span class="co">#&gt;   0.990   0.987</span></span>
<span></span>
<span><span class="co">#Plot model results:</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">regionsmodel</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-41-1.png" alt="**Fig.18.** Best fit segmented linear regression model on PCO 1-3 when forcing breakpoint position at vertebrae 19, 24, 27, 32, 35, 38, and 41." width="60%"><p class="caption">
<strong>Fig.18.</strong> Best fit segmented linear regression model on
PCO 1-3 when forcing breakpoint position at vertebrae 19, 24, 27, 32,
35, 38, and 41.
</p>
</div>
</div>
<div class="section level3">
<h3 id="subsampling-elements">Subsampling elements<a class="anchor" aria-label="anchor" href="#subsampling-elements"></a>
</h3>
<p>For specimens with numerous elements (more than 100), computational
time can become high. It can then be useful to run the regionalization
analysis on a subset of elements If the analyses are run in a
comparative framework and there is substantial variation of the number
of elements across specimens, it is also advised to subsample elements
to a constant number of elements for all specimens.</p>
<p><code><a href="../reference/subsample.html">subsample()</a></code> allows one to subsample elements either by
providing the number of elements to retain or the proportion of total
elements to retain.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retain 33 vertebrae</span></span>
<span><span class="va">dolphin_pco_sub.33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, sample <span class="op">=</span> <span class="fl">33</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retain 70% of initial number of vertebrae</span></span>
<span><span class="va">dolphin_pco_sub.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">dolphin_pco</span>, sample <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco_sub.33</span>, name <span class="op">=</span> <span class="st">"Dolphin 33"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotvertmap.html">plotvertmap</a></span><span class="op">(</span><span class="va">dolphin_pco_sub.7</span>, name <span class="op">=</span> <span class="st">"Dolphin .7"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-42-1.png" alt="**Fig.19.** Vertebral map of dolphin dataset with 33 subsampled vetrebrae *(top)* and 70% of total vertebrae subsampled *(bottom)*. Vertebrae dropped are in grey and vertebrae retained are in blue shade*." width="672"><img src="MorphoRegions_files/figure-html/unnamed-chunk-42-2.png" alt="**Fig.19.** Vertebral map of dolphin dataset with 33 subsampled vetrebrae *(top)* and 70% of total vertebrae subsampled *(bottom)*. Vertebrae dropped are in grey and vertebrae retained are in blue shade*." width="672"><p class="caption">
<strong>Fig.19.</strong> Vertebral map of dolphin dataset with 33
subsampled vetrebrae <em>(top)</em> and 70% of total vertebrae
subsampled <em>(bottom)</em>. Vertebrae dropped are in grey and
vertebrae retained are in blue shade*.
</p>
</div>
<p>By default, elements to drop will be selected to be equidistant along
the structure (rounded to integers). A random subsampling of elements
along the structure can be applied by supplying
<code>type = "random"</code> to <code><a href="../reference/subsample.html">subsample()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="simulating-data">Simulating data<a class="anchor" aria-label="anchor" href="#simulating-data"></a>
</h3>
<p><code><a href="../reference/simregions.html">simregions()</a></code> allows one to simulate datasets that
satisfy some user-defined constraints such as number of elements,
regions, PCO axes, minimum number of elements per region, variance
around the linear fits, and difference in slope between successive
linear segments.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate data </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simregions.html">simregions</a></span><span class="op">(</span>nvert <span class="op">=</span> <span class="fl">40</span>, nregions <span class="op">=</span> <span class="fl">5</span>, nvar <span class="op">=</span> <span class="fl">4</span>, r2 <span class="op">=</span> <span class="fl">.92</span>,</span>
<span>                  minvert <span class="op">=</span> <span class="fl">3</span>, cont <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-43-1.png" alt="**Fig.20.** Plot on PCO 1 and 2 of the **simulated dataset** with 40 vertebrae and 5 regions (4 breakpoints)." width="65%"><p class="caption">
<strong>Fig.20.</strong> Plot on PCO 1 and 2 of the <strong>simulated
dataset</strong> with 40 vertebrae and 5 regions (4 breakpoints).
</p>
</div>
<p>The regionalization analysis can then be run on the simulated
dataset.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcregions.html">calcregions</a></span><span class="op">(</span><span class="va">sim</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, noregions <span class="op">=</span> <span class="fl">6</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simmodels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelselect.html">modelselect</a></span><span class="op">(</span><span class="va">simresults</span><span class="op">)</span></span>
<span><span class="va">simmodels</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 BP 5  sumRSS  RSS.1  RSS.2  RSS.3   RSS.4</span></span>
<span><span class="co">#&gt;        1    .    .    .    .    . 239.092 26.450 72.184 28.139 112.318</span></span>
<span><span class="co">#&gt;        2   29    .    .    .    . 185.535  8.393 39.551 26.728 110.863</span></span>
<span><span class="co">#&gt;        3   19   28    .    .    . 148.383  4.114 31.513 22.545  90.211</span></span>
<span><span class="co">#&gt;        4   20   28   34    .    . 128.804  4.623 23.291  9.623  91.267</span></span>
<span><span class="co">#&gt;        5   15   21   28   34    . 109.794  1.835 11.249  9.891  86.820</span></span>
<span><span class="co">#&gt;        6    4   15   21   28   34 105.817  1.724 11.209  7.410  85.474</span></span>
<span></span>
<span><span class="va">simsupport</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelsupport.html">modelsupport</a></span><span class="op">(</span><span class="va">simmodels</span><span class="op">)</span></span>
<span><span class="va">simsupport</span></span>
<span><span class="co">#&gt; - Model support (AICc)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 BP 5  sumRSS   AICc deltaAIC model_lik Ak_weight</span></span>
<span><span class="co">#&gt;        5   15   21   28   34    . 109.794  8.147    0.000     1.000     0.988</span></span>
<span><span class="co">#&gt;        6    4   15   21   28   34 105.817 17.655    9.508     0.009     0.009</span></span>
<span><span class="co">#&gt;        4   20   28   34    .    . 128.804 19.417   11.270     0.004     0.004</span></span>
<span><span class="co">#&gt;        3   19   28    .    .    . 148.383 28.790   20.644     0.000     0.000</span></span>
<span><span class="co">#&gt;        2   29    .    .    .    . 185.535 52.184   44.037     0.000     0.000</span></span>
<span><span class="co">#&gt;        1    .    .    .    .    . 239.092 81.221   73.075     0.000     0.000</span></span>
<span><span class="co">#&gt; Region score: 5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Model support (BIC)</span></span>
<span><span class="co">#&gt;  Regions BP 1 BP 2 BP 3 BP 4 BP 5  sumRSS     BIC deltaBIC model_lik BIC_weight</span></span>
<span><span class="co">#&gt;        3   19   28    .    .    . 148.383  79.292    0.000     1.000      0.650</span></span>
<span><span class="co">#&gt;        5   15   21   28   34    . 109.794  81.855    2.562     0.278      0.181</span></span>
<span><span class="co">#&gt;        4   20   28   34    .    . 128.804  82.028    2.736     0.255      0.166</span></span>
<span><span class="co">#&gt;        2   29    .    .    .    . 185.535  89.668   10.376     0.006      0.004</span></span>
<span><span class="co">#&gt;        6    4   15   21   28   34 105.817 101.326   22.034     0.000      0.000</span></span>
<span><span class="co">#&gt;        1    .    .    .    .    . 239.092 104.869   25.577     0.000      0.000</span></span>
<span><span class="co">#&gt; Region score: 3.52</span></span>
<span></span>
<span><span class="fu"><a href="../reference/modelperf.html">modelperf</a></span><span class="op">(</span><span class="va">sim</span>, modelsupport <span class="op">=</span> <span class="va">simsupport</span>, criterion <span class="op">=</span> <span class="st">"aic"</span>, model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Breakpoints: 15, 21, 28, 34 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Univariate:</span></span>
<span><span class="co">#&gt;          R² Adj. R²</span></span>
<span><span class="co">#&gt; PCO.1 0.931   0.921</span></span>
<span><span class="co">#&gt; PCO.2 0.907   0.894</span></span>
<span><span class="co">#&gt; PCO.3 0.883   0.866</span></span>
<span><span class="co">#&gt; PCO.4 0.884   0.867</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Multivariate:</span></span>
<span><span class="co">#&gt;      R² Adj. R² </span></span>
<span><span class="co">#&gt;   0.888   0.872</span></span>
<span></span>
<span><span class="co">#Plot best model fit</span></span>
<span><span class="fu"><a href="../reference/plotsegreg.html">plotsegreg</a></span><span class="op">(</span><span class="va">sim</span>, scores <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, modelsupport <span class="op">=</span> <span class="va">simsupport</span>,</span>
<span>            criterion <span class="op">=</span> <span class="st">"aic"</span>, model <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MorphoRegions_files/figure-html/unnamed-chunk-44-1.png" alt="**Fig.21.** Plot on PCO 1 and 2 of the **recovered best fit** on regionalization analysis ran on the simulated dataset." width="65%"><p class="caption">
<strong>Fig.21.</strong> Plot on PCO 1 and 2 of the <strong>recovered
best fit</strong> on regionalization analysis ran on the simulated
dataset.
</p>
</div>
<p>The simulated dataset had 5 predefined regions with breakpoints at
vertebrae 16, 20, 29, and 34. When running the regionalization analysis
on the simulated dataset, the analysis correctly recovered the 5 regions
model as the best fit model using AICc, however the 5 regions model is
second best using BIC.</p>
<p>The AICc best fit model recovered breakpoints at vertebrae 15, 21,
28, 34. The recovered position of the first three breakpoints differ
sightly from the simulated positions, and the recovered position of the
fourth breakpoint matches that of the simulated data.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulated data breakpoints:</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">BPs</span></span>
<span><span class="co">#&gt; breakpoint1 breakpoint2 breakpoint3 breakpoint4 </span></span>
<span><span class="co">#&gt;          16          20          29          34</span></span>
<span></span>
<span><span class="co"># Recovered best fit breakpoints:</span></span>
<span><span class="va">simsupport</span><span class="op">$</span><span class="va">Model_support</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;       breakpoint1 breakpoint2 breakpoint3 breakpoint4</span></span>
<span><span class="co">#&gt; 26746          15          21          28          34</span></span>
<span></span>
<span><span class="co"># Variability of recovered best fit breakpoints:</span></span>
<span><span class="fu"><a href="../reference/calcBPvar.html">calcBPvar</a></span><span class="op">(</span><span class="va">simresults</span>, noregions <span class="op">=</span> <span class="fl">5</span>, pct <span class="op">=</span> <span class="fl">0.1</span>, criterion <span class="op">=</span> <span class="st">"aic"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         BP 1   BP 2   BP 3   BP 4</span></span>
<span><span class="co">#&gt; wMean 15.184 20.652 28.138 34.249</span></span>
<span><span class="co">#&gt; wSD    1.618  0.788  0.511  0.710</span></span>
<span><span class="co">#&gt; - Computed using top 10% of models</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Gillet2022" class="csl-entry">
Gillet, A., B. Frédérich, S. E. Pierce, and E. Parmentier. 2022.
<span>“Iterative Habitat Transitions Are Associated with Morphological
Convergence of the Backbone in Delphinoids.”</span> <em>Journal of
Mammalian Evolution</em> 29: 931–46. <a href="https://doi.org/10.1007/s10914-022-09615-7" class="external-link">https://doi.org/10.1007/s10914-022-09615-7</a>.
</div>
<div id="ref-GilRev" class="csl-entry">
Gillet, A., K. E. Jones, and S. E. Pierce. Under Review.
<span>“Repatterning of Mammalian Backbone Regionalization in
Cetaceans,”</span> Under Review.
</div>
<div id="ref-Head2015" class="csl-entry">
Head, J. J., and P. D. Polly. 2015. <span>“Evolution of the Snake Body
Form Reveals Homoplasy in Amniote Hox Gene Function.”</span>
<em>Nature</em> 520: 86–89. <a href="https://doi.org/10.1038/nature14042" class="external-link">https://doi.org/10.1038/nature14042</a>.
</div>
<div id="ref-Jones2018" class="csl-entry">
Jones, K. E., K. D. Angielczyk, P. D. Polly, J. J. Head, V. Fernandez,
J. K. Lungmus, S. Tulga, and S. E. Pierce. 2018. <span>“Fossils Reveal
the Complex Evolutionary History of the Mammalian Regionalized
Spine.”</span> <em>Science</em> 361: 1249–52. <a href="https://doi.org/10.1126/science.aar3126" class="external-link">https://doi.org/10.1126/science.aar3126</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Amandine Gillet, Katrina Jones, Noah Greifer, Stephanie Pierce.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
